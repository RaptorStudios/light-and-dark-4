/*! l4w 2015-07-05 */
var Display;!function(a){function b(a){n=a,Resource.loadPropertes("l4w",c)}function c(a){q=a.cellHeight,r=a.cellWidth,e()}function d(a,b){var c=n.getBoundingClientRect(),d=Math.floor((a-c.left)/q),e=Math.floor((b-c.top)/r);return{x:d,y:e}}function e(){a.canvasH=n.height,a.canvasW=n.width,o=Math.floor(a.canvasH/q),p=Math.floor(a.canvasW/r),s=o/2,t=p/2}function f(a){var b=Math.floor(a/r-t);return 0>b&&(b=0),b}function g(a){var b=Math.floor(a/q-s);return 0>b&&(b=0),b}function h(a,b){var c=Math.ceil(a/r+t);return c>b&&(c=b),c}function i(a,b){var c=Math.ceil(a/q+s);return c>b&&(c=b),c}function j(a){return a%r}function k(a){return a%q}function l(a){return(a+.5)*r}function m(a){return(a+.5)*q}var n;a.canvasH,a.canvasW;var o,p,q,r,s,t;a.init=b,a.mapPosition=d,a.refresh=e,a.getMinX=f,a.getMinY=g,a.getMaxX=h,a.getMaxY=i,a.getOffsetX=j,a.getOffsetY=k,a.getPointerX=l,a.getPointerY=m}(Display||(Display={}));var Input;!function(a){function b(a,b,d,e,f,g,h,i,j,k,l,m,n,o){function p(a){return Display.mapPosition(a.clientX,a.clientY)}var q,r=!1;b[c.SPACE]=function(){r?(k(),r=!1):(j(),r=!0)};var s=!1;a.addEventListener("click",function(b){var c=a.getBoundingClientRect(),d=b.clientX-c.left,f=b.clientY-c.top;e(d,f)}),a.addEventListener("mousemove",function(b){var c=(a.getBoundingClientRect(),p(b));s?h(c.x,c.y):i(c.x,c.y)}),a.addEventListener("mousedown",function(a){s=!0;var b=p(a);f(b.x,b.y)}),a.addEventListener("mouseup",function(a){s=!1;var b=p(a);g(b.x,b.y)}),a.addEventListener("mouseout",function(){s?h(null,null):i(null,null)}),a.addEventListener("contextmenu",function(a){var b=p(a);m(b.x,b.y)}),a.addEventListener("dblclick",function(a){var b=p(a);n(b.x,b.y)}),a.addEventListener("wheel",function(a){a.preventDefault();var b=p(a);o(b.x,b.y)}),a.addEventListener("touchstart",function(a){var b=p(a);f(b.x,b.y)}),a.addEventListener("touchend",function(a){var b=p(a);g(b.x,b.y)}),a.addEventListener("touchcancel",function(a){var b=p(a);g(b.x,b.y)}),a.addEventListener("touchmove",function(a){var b=p(a);h(b.x,b.y)}),document.addEventListener("keydown",function(a){var c=b[a.keyCode+""];void 0!==c&&(a.preventDefault(),c(a)),q=a.keyCode}),document.addEventListener("keyup",function(a){a.keyCode===q&&d()}),document.addEventListener("visibilitychange",function(){document.hidden?(j(),r=!0):(k(),r=!1)}),window.addEventListener("resize",function(){j(),r=!0,l()}),document.addEventListener("orientationchange",function(){l()})}var c=function(){function a(){}return a.UP="38",a.DOWN="40",a.LEFT="37",a.RIGHT="39",a.CTRL="17",a.ALT="18",a.ENTER="13",a.SPACE="32",a.CAPS="20",a.SHIFT="16",a.W="87",a.A="65",a.D="68",a.S="83",a.J="74",a.K="75",a}();a.Keys=c,a.init=b}(Input||(Input={}));var Main;!function(a){function b(a){c(a),d(a),Scene.start(a.getContext("2d"))}function c(a){Display.init(a)}function d(a){var b=new Map;b[Input.Keys.UP]=function(){console.log("Up")},b[Input.Keys.DOWN]=function(){console.log("Down")},b[Input.Keys.LEFT]=function(){console.log("Left")},b[Input.Keys.RIGHT]=function(){console.log("Right")},Input.init(a,b,function(){console.log("reset")},function(){console.log("action")},function(){console.log("start")},function(){Scene.updatePointer(null,null)},function(a,b){Scene.updatePointer(a,b)},function(a,b){Scene.updatePointer(a,b)},function(){console.log("pause"),Scene.togglePause(!0)},function(){console.log("unpause"),Scene.togglePause(!1)},function(){console.log("resize")},function(){console.log("rightClick")},function(){console.log("doubleClick")},function(){console.log("wheel")})}a.start=b}(Main||(Main={}));var Resource;!function(a){function b(a,b){function g(){var d=c(this.responseText);f[a]=d,b(d)}return a in f?f[a]:void d(e+a+".properties",g)}function c(a){for(var b=new Map,c=a.split("\n"),d=0;d<c.length;d++){var e=c[d].trim();if(""!==e&&0!==e.indexOf("#")){var f=e.split("=");b[f[0]]=f[1]}}return b}function d(a,b){function c(){console.log("error getting "+a)}function d(){console.log("timeout getting "+a)}var e=new XMLHttpRequest;e.onload=b,e.onerror=c,e.ontimeout=d,e.open("get",a,!0),e.send()}var e="data/",f=new Map;a.loadPropertes=b}(Resource||(Resource={}));var Actor;!function(a){var b=function(){function a(){this.states=[],this.states.push(new c(this)),this.state=0}return a.prototype.update=function(a,b,c){this.states[this.state].update(a,b,c)},a.prototype.render=function(a,b){this.states[this.state].render(a,b)},a}();a.Event=b;var c=function(){function a(a){this.event=a}return a.prototype.update=function(){},a.prototype.render=function(){},a}()}(Actor||(Actor={}));var Scene;!function(a){function b(a){m=new Actor.Event,o=new World.Map,p={x:0,y:0},q={x:0,y:0},s=a,c()}function c(){if(w(c),!v){s.clearRect(0,0,Display.canvasW,Display.canvasH),s.fillStyle="#000000",s.font="bold 40px Arial",s.fillText("(it's not ready yet)",150,260);var a=Time.getTime();m.update(n,o,a);for(var b in n)b.update(n,o,a);g();for(var h=o.getLayers(),i=Display.getMinY(p.y),j=Display.getMaxY(p.y,o.columns),k=i;j>=k;k++){for(var l=0;h>l;l++)d(k,l);e(k)}f()}}function d(){}function e(){}function f(){null!=q.x&&null!=q.y&&(s.save(),s.beginPath(),s.fillStyle=Constant.Color.yellow,s.arc(Display.getPointerX(q.x),Display.getPointerY(q.y),12,0,Constant.DOUBLE_PI,!0),s.closePath(),s.globalAlpha=.4,s.fill(),s.restore())}function g(){}function h(a){null!=a?r.showGrid=a:r.showGrid=!r.showGrid}function i(a){null!=a?r.showFPS=a:r.showFPS=!r.showFPS}function j(a){null!=a?r.showCellNumbers=a:r.showCellNumbers=!r.showCellNumbers}function k(a){v=null!=a?a:!v}function l(a,b){q.x=a,q.y=b}var m,n,o,p,q,r,s,t=20,u=1e3/t,v=!1,w=window.requestAnimationFrame||window.msRequestAnimationFrame||function(){window.setTimeout(c,u)};a.start=b,a.toggleGrid=h,a.toggleFPS=i,a.toggleCellNumbering=j,a.togglePause=k,a.updatePointer=l}(Scene||(Scene={}));var World;!function(a){var b=function(){function a(){this.rows=30,this.columns=30,this.layers=[]}return a.prototype.render=function(a,b,c){for(var d in this.layers)d.render(a,b,c)},a.prototype.getLayers=function(){return this.layers.length},a}();a.Map=b;var c=(function(){function a(){}return a.prototype.render=function(){},a}(),function(){function a(){this.showGrid=!1,this.showFPS=!1,this.showCellNumbers=!1,this.fps=0}return a}());a.Options=c}(World||(World={}));